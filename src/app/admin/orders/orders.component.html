<div class="order-list-container">
  <div class="header">
    <h1>Order Management</h1>
    <div class="header-actions">
      <button class="btn-export" (click)="exportOrders()">Export CSV</button>
      <button class="btn-refresh" (click)="loadOrders()">Refresh</button>
    </div>
  </div>

  <div class="filters-section">
    <h3>Filters</h3>
    <div class="filters-grid">
      <div class="filter-group">
        <label>Search</label>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          placeholder="Order number, customer, restaurant..."
          (keyup.enter)="applyFilters()"
        />
      </div>

      <div class="filter-group">
        <label>Status</label>
        <select [(ngModel)]="selectedStatus">
          <option value="">All Statuses</option>
          <option *ngFor="let status of orderStatuses" [value]="status">
            {{ status }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Payment Status</label>
        <select [(ngModel)]="selectedPaymentStatus">
          <option value="">All Payment Statuses</option>
          <option *ngFor="let status of paymentStatuses" [value]="status">
            {{ status }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Start Date</label>
        <input type="date" [(ngModel)]="startDate" />
      </div>

      <div class="filter-group">
        <label>End Date</label>
        <input type="date" [(ngModel)]="endDate" />
      </div>
    </div>

    <div class="filter-actions">
      <button class="btn-apply" (click)="applyFilters()">Apply Filters</button>
      <button class="btn-clear" (click)="clearFilters()">Clear Filters</button>
    </div>
  </div>

  <div *ngIf="selectedOrders.size > 0" class="bulk-actions">
    <span>{{ selectedOrders.size }} orders selected</span>
    <div class="bulk-buttons">
      <button (click)="bulkUpdateStatus(orderStatuses[1])">Confirm</button>
      <button (click)="bulkUpdateStatus(orderStatuses[2])">Preparing</button>
      <button (click)="bulkUpdateStatus(orderStatuses[3])">Out for Delivery</button>
      <button (click)="bulkUpdateStatus(orderStatuses[4])">Delivered</button>
      <button (click)="bulkUpdateStatus(orderStatuses[5])" class="btn-danger">Cancel</button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Loading orders...</div>

  <div *ngIf="!loading" class="table-container">
    <table class="orders-table">
      <thead>
        <tr>
          <th>
            <input
              type="checkbox"
              [checked]="selectedOrders.size === orders.length && orders.length > 0"
              (change)="toggleAllOrders()"
            />
          </th>
          <th (click)="sortBy('orderNumber')" class="sortable">
            Order #
            <span class="sort-icon" *ngIf="sortColumn === 'orderNumber'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="sortBy('customerName')" class="sortable">
            Customer
            <span class="sort-icon" *ngIf="sortColumn === 'customerName'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="sortBy('restaurantName')" class="sortable">
            Restaurant
            <span class="sort-icon" *ngIf="sortColumn === 'restaurantName'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="sortBy('totalAmount')" class="sortable">
            Amount
            <span class="sort-icon" *ngIf="sortColumn === 'totalAmount'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th>Status</th>
          <th>Payment</th>
          <th (click)="sortBy('orderDate')" class="sortable">
            Date
            <span class="sort-icon" *ngIf="sortColumn === 'orderDate'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders">
          <td>
            <input
              type="checkbox"
              [checked]="selectedOrders.has(order.id)"
              (change)="toggleOrderSelection(order.id)"
            />
          </td>
          <td>
            <a [routerLink]="['/orders', order.id]" class="order-link">
              {{ order.orderNumber }}
            </a>
          </td>
          <td>{{ order.customerName }}</td>
          <td>{{ order.restaurantName }}</td>
          <td>{{ formatCurrency(order.totalAmount) }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusBadgeClass(order.status)">
              {{ order.status }}
            </span>
          </td>
          <td>{{ order.paymentStatus }}</td>
          <td>{{ order.orderDate | date:'short' }}</td>
          <td>
            <div class="action-buttons">
              <button
                [routerLink]="['/orders', order.id]"
                class="btn-view"
                title="View Details"
              >
                View
              </button>
              <button
                (click)="deleteOrder(order.id)"
                class="btn-delete"
                title="Delete"
              >
                Delete
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="orders.length === 0" class="no-data">
      No orders found matching your criteria.
    </div>
  </div>

  <div class="pagination" *ngIf="!loading && totalOrders > 0">
    <button
      class="btn-page"
      (click)="previousPage()"
      [disabled]="currentPage === 1"
    >
      Previous
    </button>
    <span class="page-info">
      Page {{ currentPage }} of {{ getTotalPages() }}
      ({{ totalOrders }} total orders)
    </span>
    <button
      class="btn-page"
      (click)="nextPage()"
      [disabled]="currentPage * pageSize >= totalOrders"
    >
      Next
    </button>
  </div>
</div>
