<div class="min-h-screen bg-gray-50 p-6">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Order & Cart Management</h1>
    <p class="text-gray-600">Monitor orders and track active shopping carts</p>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative">
    <span class="block sm:inline">{{ error }}</span>
    <button (click)="error = null" class="absolute top-0 bottom-0 right-0 px-4 py-3">
      <span class="text-2xl">&times;</span>
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="mb-6 border-b border-gray-200">
    <nav class="flex gap-4">
      <button
        (click)="switchTab('orders')"
        [class.border-b-2]="activeTab === 'orders'"
        [class.border-blue-600]="activeTab === 'orders'"
        [class.text-blue-600]="activeTab === 'orders'"
        [class.text-gray-500]="activeTab !== 'orders'"
        class="pb-4 px-2 font-medium transition-colors">
        Orders ({{ orders.length }})
      </button>
      <button
        (click)="switchTab('carts')"
        [class.border-b-2]="activeTab === 'carts'"
        [class.border-blue-600]="activeTab === 'carts'"
        [class.text-blue-600]="activeTab === 'carts'"
        [class.text-gray-500]="activeTab !== 'carts'"
        class="pb-4 px-2 font-medium transition-colors">
        Active Carts ({{ carts.length }})
      </button>
    </nav>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600">Total Orders</p>
          <p class="text-2xl font-bold text-gray-900">{{ stats.totalOrders }}</p>
        </div>
        <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
        </svg>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600">Total Revenue</p>
          <p class="text-2xl font-bold text-gray-900">{{ formatCurrency(stats.totalRevenue) }}</p>
        </div>
        <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600">Pending Orders</p>
          <p class="text-2xl font-bold text-gray-900">{{ stats.pendingOrders }}</p>
        </div>
        <svg class="w-8 h-8 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
    </div>

    <div class="bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600">Active Carts</p>
          <p class="text-2xl font-bold text-gray-900">{{ carts.length }}</p>
        </div>
        <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
      </div>
    </div>
  </div>

  <!-- Orders Tab -->
  <div *ngIf="activeTab === 'orders'">
    <!-- Filters -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <!-- Search -->
        <div class="relative">
          <input
            type="text"
            placeholder="Search orders..."
            [(ngModel)]="filters.searchQuery"
            (ngModelChange)="onFilterChange()"
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>

        <!-- Status Filter -->
        <select
          [(ngModel)]="filters.status"
          (ngModelChange)="onFilterChange()"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option [ngValue]="undefined">All Status</option>
          <option *ngFor="let status of orderStatuses" [value]="status">
            {{ formatStatusText(status) }}
          </option>
        </select>

        <!-- Date Range Filter -->
        <select
          [(ngModel)]="filters.dateRange"
          (ngModelChange)="onFilterChange()"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option value="ALL">All Time</option>
          <option value="TODAY">Today</option>
          <option value="WEEK">Last 7 Days</option>
          <option value="MONTH">Last 30 Days</option>
        </select>

        <!-- Advanced Filters Toggle -->
        <button
          (click)="showAdvancedFilters = !showAdvancedFilters"
          class="flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
          </svg>
          Advanced Filters
        </button>
      </div>

      <!-- Advanced Filters Panel -->
      <div *ngIf="showAdvancedFilters" class="grid grid-cols-1 md:grid-cols-4 gap-4 pt-4 border-t border-gray-200">
        <select
          [(ngModel)]="filters.paymentStatus"
          (ngModelChange)="onFilterChange()"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option [ngValue]="undefined">All Payment Status</option>
          <option *ngFor="let status of paymentStatuses" [value]="status">
            {{ status }}
          </option>
        </select>

        <select
          [(ngModel)]="filters.deliveryType"
          (ngModelChange)="onFilterChange()"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option [ngValue]="undefined">All Delivery Types</option>
          <option *ngFor="let type of deliveryTypes" [value]="type">
            {{ type }}
          </option>
        </select>

        <select
          [(ngModel)]="filters.priorityLevel"
          (ngModelChange)="onFilterChange()"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option [ngValue]="undefined">All Priority Levels</option>
          <option *ngFor="let level of priorityLevels" [value]="level">
            Priority {{ level }}
          </option>
        </select>

        <div class="flex gap-2">
          <input
            type="number"
            placeholder="Min ৳"
            [(ngModel)]="filters.minAmount"
            (ngModelChange)="onFilterChange()"
            class="w-1/2 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <input
            type="number"
            placeholder="Max ৳"
            [(ngModel)]="filters.maxAmount"
            (ngModelChange)="onFilterChange()"
            class="w-1/2 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-2 mt-4">
        <button
          (click)="clearFilters()"
          class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors">
          Clear Filters
        </button>
        <button
          (click)="refreshData()"
          class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          Refresh
        </button>
        <button
          (click)="exportOrders()"
          class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Orders Table -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Order Details</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Restaurant</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let order of filteredOrders" class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ order.orderNumber }}</div>
                <div class="text-xs text-gray-500">{{ order.deliveryType }}</div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm text-gray-900">{{ order.customerName }}</div>
                <div class="text-xs text-gray-500">{{ order.customerPhone }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ order.restaurantName }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ formatDate(order.orderDate) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ formatCurrency(order.totalAmount) }}</div>
                <span [class]="'px-1.5 py-0.5 text-xs rounded ' + getStatusColor(order.paymentStatus)">
                  {{ order.paymentStatus }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span [class]="'px-2 py-1 text-xs font-semibold rounded-full ' + getStatusColor(order.orderStatus)">
                  {{ formatStatusText(order.orderStatus) }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div *ngFor="let i of [1,2,3,4,5]"
                    [class]="'w-2 h-2 rounded-full mr-1 ' + (i <= order.priorityLevel ? 'bg-orange-400' : 'bg-gray-200')">
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <button
                  (click)="viewOrderDetails(order)"
                  class="text-blue-600 hover:text-blue-800 font-medium">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                  </svg>
                </button>
              </td>
            </tr>
            <tr *ngIf="filteredOrders.length === 0">
              <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                No orders found matching your filters
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Carts Tab -->
  <div *ngIf="activeTab === 'carts'">
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="p-4 bg-gray-50 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-900">Active Shopping Carts</h3>
          <button
            (click)="refreshData()"
            class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            Refresh
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cart ID</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User Details</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Restaurant</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Items</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subtotal</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Activity</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngFor="let cart of carts" class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">#{{ cart.id }}</div>
                <div class="text-xs text-gray-500">User ID: {{ cart.userId }}</div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm text-gray-900">{{ cart.userName }}</div>
                <div class="text-xs text-gray-500">{{ cart.userEmail }}</div>
                <div class="text-xs text-gray-500">{{ cart.userPhone }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ cart.restaurantName }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ cart.totalItems }} items</div>
                <div class="text-xs text-gray-500">{{ cart.items.length }} types</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                {{ formatCurrency(cart.subtotal) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-900">{{ formatTimeAgo(cart.updatedAt) }}</div>
                <div class="text-xs text-gray-500">{{ formatDate(cart.updatedAt) }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <button
                  (click)="viewCartDetails(cart)"
                  class="text-blue-600 hover:text-blue-800 font-medium">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                  </svg>
                </button>
              </td>
            </tr>
            <tr *ngIf="carts.length === 0">
              <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                No active carts found
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Order Detail Modal -->
  <div *ngIf="showOrderModal && selectedOrder" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg max-w-4xl w-full max-h-screen overflow-y-auto">
      <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between z-10">
        <div>
          <h2 class="text-2xl font-bold text-gray-900">Order Details</h2>
          <p class="text-sm text-gray-500 mt-1">{{ selectedOrder.orderNumber }}</p>
        </div>
        <button (click)="closeOrderModal()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="p-6">
        <!-- Status Banner -->
        <div [class]="'mb-6 p-4 rounded-lg border ' +
          (selectedOrder.orderStatus === 'DELIVERED' ? 'bg-green-50 border-green-200' :
           selectedOrder.orderStatus === 'CANCELLED' ? 'bg-red-50 border-red-200' :
           'bg-blue-50 border-blue-200')">
          <div class="flex items-center justify-between">
            <div>
              <span [class]="'px-3 py-1 text-sm font-semibold rounded-full ' + getStatusColor(selectedOrder.orderStatus)">
                {{ formatStatusText(selectedOrder.orderStatus) }}
              </span>
              <span [class]="'ml-2 px-3 py-1 text-sm font-semibold rounded-full ' + getStatusColor(selectedOrder.paymentStatus)">
                {{ selectedOrder.paymentStatus }}
              </span>
            </div>
            <div class="text-right" *ngIf="selectedOrder.estimatedDeliveryTime">
              <p class="text-sm text-gray-600">Estimated Delivery</p>
              <p class="text-lg font-semibold">{{ formatDate(selectedOrder.estimatedDeliveryTime) }}</p>
            </div>
          </div>
        </div>

        <!-- Three Column Layout -->
        <div class="grid grid-cols-3 gap-6 mb-6">
          <!-- Customer Information -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-3">Customer Information</h3>
            <div class="space-y-2">
              <div>
                <p class="text-xs text-gray-500">Name</p>
                <p class="text-sm font-medium">{{ selectedOrder.customerName }}</p>
              </div>
              <div *ngIf="selectedOrder.customerPhone">
                <p class="text-xs text-gray-500">Phone</p>
                <p class="text-sm">{{ selectedOrder.customerPhone }}</p>
              </div>
              <div *ngIf="selectedOrder.customerEmail">
                <p class="text-xs text-gray-500">Email</p>
                <p class="text-sm">{{ selectedOrder.customerEmail }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Customer ID</p>
                <p class="text-sm">#{{ selectedOrder.customerId }}</p>
              </div>
            </div>
          </div>

          <!-- Restaurant Information -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-3">Restaurant Information</h3>
            <div class="space-y-2">
              <div>
                <p class="text-xs text-gray-500">Restaurant</p>
                <p class="text-sm font-medium">{{ selectedOrder.restaurantName }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Restaurant ID</p>
                <p class="text-sm">#{{ selectedOrder.restaurantId }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Order Date</p>
                <p class="text-sm">{{ formatDate(selectedOrder.orderDate) }}</p>
              </div>
            </div>
          </div>

          <!-- Delivery Information -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-3">Delivery Information</h3>
            <div class="space-y-2">
              <div>
                <p class="text-xs text-gray-500">Address</p>
                <p class="text-sm">{{ selectedOrder.deliveryAddress }}</p>
              </div>
              <div *ngIf="selectedOrder.deliveryLatitude && selectedOrder.deliveryLongitude">
                <p class="text-xs text-gray-500">Coordinates</p>
                <p class="text-xs">{{ selectedOrder.deliveryLatitude.toFixed(4) }}, {{ selectedOrder.deliveryLongitude.toFixed(4) }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Delivery Type</p>
                <p class="text-sm font-medium">{{ selectedOrder.deliveryType }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Priority Level</p>
                <div class="flex items-center gap-1">
                  <div *ngFor="let i of [1,2,3,4,5]"
                    [class]="'w-3 h-3 rounded-full ' + (i <= selectedOrder.priorityLevel ? 'bg-orange-400' : 'bg-gray-300')">
                  </div>
                  <span class="ml-2 text-sm">({{ selectedOrder.priorityLevel }}/5)</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Special Instructions -->
        <div *ngIf="selectedOrder.specialInstructions" class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
          <div class="flex items-start gap-2">
            <svg class="w-5 h-5 text-yellow-600 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            <div>
              <p class="text-sm font-medium text-yellow-800">Special Instructions</p>
              <p class="text-sm text-yellow-700 mt-1">{{ selectedOrder.specialInstructions }}</p>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-4">Order Items ({{ selectedOrder.orderItems.length }})</h3>
          <div class="bg-gray-50 rounded-lg overflow-hidden">
            <table class="w-full">
              <thead class="bg-gray-100 border-b border-gray-200">
                <tr>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Item</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Unit Price</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                  <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr *ngFor="let item of selectedOrder.orderItems">
                  <td class="px-4 py-3">
                    <div class="text-sm font-medium text-gray-900">{{ item.menuItemName }}</div>
                    <div *ngIf="item.specialInstructions || item.customizations" class="text-xs text-gray-500 mt-1">
                      <div *ngIf="item.specialInstructions">• {{ item.specialInstructions }}</div>
                      <div *ngIf="item.customizations">• {{ item.customizations }}</div>
                    </div>
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-900">{{ formatCurrency(item.unitPrice!) }}</td>
                  <td class="px-4 py-3 text-sm text-gray-900">x {{ item.quantity }}</td>
                  <td class="px-4 py-3 text-sm font-medium text-gray-900 text-right">{{ formatCurrency(item.totalPrice!) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Price Breakdown -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <h3 class="text-lg font-semibold mb-3">Price Breakdown</h3>
          <div class="space-y-2">
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Subtotal</span>
              <span class="font-medium">{{ formatCurrency(selectedOrder.subtotal) }}</span>
            </div>
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Delivery Fee</span>
              <span class="font-medium">{{ formatCurrency(selectedOrder.deliveryFee) }}</span>
            </div>
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Tax (10%)</span>
              <span class="font-medium">{{ formatCurrency(selectedOrder.taxAmount) }}</span>
            </div>
            <div class="flex justify-between py-3 border-t-2 border-gray-300 mt-2">
              <span class="text-lg font-semibold">Total Amount</span>
              <span class="text-xl font-bold text-blue-600">{{ formatCurrency(selectedOrder.totalAmount) }}</span>
            </div>
          </div>
        </div>

        <!-- Status Update Actions -->
        <div class="border-t border-gray-200 pt-6">
          <h3 class="text-lg font-semibold mb-4">Update Order Status</h3>
          <div class="flex flex-wrap gap-2">
            <button
              *ngFor="let status of orderStatuses"
              (click)="updateOrderStatus(selectedOrder.id, status)"
              [disabled]="selectedOrder.orderStatus === status"
              [class]="'px-4 py-2 rounded-lg text-sm font-medium transition-colors ' +
                (selectedOrder.orderStatus === status
                  ? 'bg-gray-200 text-gray-500 cursor-not-allowed'
                  : status === 'CANCELLED'
                  ? 'bg-red-600 text-white hover:bg-red-700'
                  : 'bg-blue-600 text-white hover:bg-blue-700')">
              {{ selectedOrder.orderStatus === status ? '✓ ' : '' }}
              {{ formatStatusText(status) }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Detail Modal -->
  <div *ngIf="showCartModal && selectedCart" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg max-w-3xl w-full max-h-screen overflow-y-auto">
      <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between z-10">
        <div>
          <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
            Cart Details
          </h2>
          <p class="text-sm text-gray-500 mt-1">Cart ID: #{{ selectedCart.id }}</p>
        </div>
        <button (click)="closeCartModal()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="p-6">
        <!-- Cart Info Banner -->
        <div class="mb-6 p-4 bg-purple-50 border border-purple-200 rounded-lg">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-600">Total Items</p>
              <p class="text-2xl font-bold text-purple-600">{{ selectedCart.totalItems }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-600">Cart Value</p>
              <p class="text-2xl font-bold text-purple-600">{{ formatCurrency(selectedCart.subtotal) }}</p>
            </div>
          </div>
        </div>

        <!-- User and Cart Info -->
        <div class="grid grid-cols-2 gap-6 mb-6">
          <!-- User Information -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-3">User Information</h3>
            <div class="space-y-2">
              <div>
                <p class="text-xs text-gray-500">Name</p>
                <p class="text-sm font-medium">{{ selectedCart.userName }}</p>
              </div>
              <div *ngIf="selectedCart.userEmail">
                <p class="text-xs text-gray-500">Email</p>
                <p class="text-sm">{{ selectedCart.userEmail }}</p>
              </div>
              <div *ngIf="selectedCart.userPhone">
                <p class="text-xs text-gray-500">Phone</p>
                <p class="text-sm">{{ selectedCart.userPhone }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">User ID</p>
                <p class="text-sm">#{{ selectedCart.userId }}</p>
              </div>
            </div>
          </div>

          <!-- Cart Metadata -->
          <div class="bg-gray-50 rounded-lg p-4">
            <h3 class="text-sm font-semibold text-gray-700 mb-3">Cart Activity</h3>
            <div class="space-y-2">
              <div>
                <p class="text-xs text-gray-500">Restaurant</p>
                <p class="text-sm font-medium">{{ selectedCart.userName }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Created At</p>
                <p class="text-sm">{{ formatDate(selectedCart.createdAt) }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Last Updated</p>
                <p class="text-sm">{{ formatDate(selectedCart.updatedAt) }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500">Last Activity</p>
                <p class="text-sm font-medium text-orange-600">{{ formatTimeAgo(selectedCart.updatedAt) }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Cart Items -->
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-4">Cart Items ({{ selectedCart.items.length }})</h3>
          <div class="bg-gray-50 rounded-lg overflow-hidden">
            <table class="w-full">
              <thead class="bg-gray-100 border-b border-gray-200">
                <tr>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Item</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Unit Price</th>
                  <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                  <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr *ngFor="let item of selectedCart.items">
                  <td class="px-4 py-3">
                    <div class="text-sm font-medium text-gray-900">{{ item.menuItemName }}</div>
                    <div *ngIf="item.specialInstructions" class="text-xs text-gray-500 mt-1">
                      • {{ item.specialInstructions }}
                    </div>
                  </td>
                  <td class="px-4 py-3 text-sm text-gray-900">{{ formatCurrency(item.unitPrice) }}</td>
                  <td class="px-4 py-3 text-sm text-gray-900">x {{ item.quantity }}</td>
                  <td class="px-4 py-3 text-sm font-medium text-gray-900 text-right">{{ formatCurrency(item.totalPrice) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Cart Summary -->
        <div class="bg-gray-50 rounded-lg p-4 mb-6">
          <h3 class="text-lg font-semibold mb-3">Cart Summary</h3>
          <div class="space-y-2">
            <div class="flex justify-between py-2">
              <span class="text-gray-600">Subtotal ({{ selectedCart.totalItems }} items)</span>
              <span class="font-medium">{{ formatCurrency(selectedCart.subtotal) }}</span>
            </div>
            <div class="flex justify-between py-2 text-sm text-gray-500">
              <span>Estimated Tax (10%)</span>
              <span>{{ formatCurrency(selectedCart.subtotal * 0.1) }}</span>
            </div>
            <div class="flex justify-between py-2 text-sm text-gray-500">
              <span>Estimated Delivery Fee</span>
              <span>৳50 - ৳100</span>
            </div>
            <div class="flex justify-between py-3 border-t-2 border-gray-300 mt-2">
              <span class="text-lg font-semibold">Estimated Total</span>
              <span class="text-xl font-bold text-purple-600">
                {{ formatCurrency(selectedCart.subtotal * 1.1 + 75) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-3">
          <button class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
            Send Reminder to Customer
          </button>
          <button
            (click)="clearCart(selectedCart.userId)"
            class="flex-1 px-6 py-3 border-2 border-red-600 text-red-600 rounded-lg hover:bg-red-50 transition-colors font-medium">
            Clear Cart
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
