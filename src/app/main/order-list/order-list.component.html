<div class="p-6">
  <h1 class="text-3xl font-bold mb-6 text-gray-800">Your Order History</h1>
  
  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="text-center py-12 bg-gray-50 rounded-xl shadow-inner">
    <svg class="animate-spin h-8 w-8 text-emerald-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
    </svg>
    <p class="mt-3 text-emerald-600 font-medium">Loading orders...</p>
  </div>

  <div *ngIf="!isLoading && orders.length === 0" class="text-center py-10 bg-gray-50 rounded-xl border border-dashed">
    <p class="text-lg font-semibold text-gray-500">No Orders Found</p>
    <p class="text-gray-400 mt-1">It looks like you haven't placed any orders on this page.</p>
  </div>

  <!-- Order List -->
  <div *ngIf="!isLoading && orders.length > 0" class="space-y-4">
    <div *ngFor="let order of orders" 
         class="bg-white p-5 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300 border border-gray-100 flex justify-between items-center">
      
      <!-- Order Summary Left Side -->
      <div>
        <p class="text-sm font-semibold text-gray-700">Order #{{ order.orderNumber }}</p>
        <p class="text-xl font-bold text-gray-900">{{ order.restaurantName }}</p>
        
        <div class="mt-2 flex items-center space-x-2">
          <!-- Status Badge -->
          <span class="px-2 py-0.5 text-xs font-medium rounded-full"
                [ngClass]="{
                  'bg-green-100 text-green-800': order.orderStatus === 'DELIVERED',
                  'bg-yellow-100 text-yellow-800': isTrackable(order.orderStatus),
                  'bg-red-100 text-red-800': order.orderStatus === 'CANCELLED'
                }">
            {{ order.orderStatus.replace('_', ' ') | titlecase }}
          </span>
          <!-- Total -->
          <span class="text-sm font-semibold text-emerald-600">
            $ {{ order.totalAmount | number:'1.2-2' }}
          </span>
        </div>
        <p class="text-xs text-gray-500 mt-1">Placed on {{ order.createdAt | date: 'mediumDate' }}</p>
      </div>

      <!-- Actions Right Side -->
      <div class="flex flex-col items-end space-y-2">
        
        <!-- Track Button (Conditional) -->
        <button *ngIf="isTrackable(order.orderStatus)"
                (click)="trackOrder(order.id)"
                class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-emerald-600 hover:bg-emerald-700 transition-colors shadow-md">
          Track Order
        </button>

        <!-- View Details Button -->
        <button (click)="openDetailsModal(order)"
                class="px-4 py-2 text-sm font-medium rounded-lg text-emerald-600 border border-emerald-600 hover:bg-emerald-50 transition-colors">
          View Details
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div *ngIf="!isLoading && totalPages > 1" class="flex justify-between items-center mt-6 p-4 bg-white rounded-xl shadow-inner border border-gray-100">
    <p class="text-sm text-gray-600">
      Page {{ currentPage + 1 }} of {{ totalPages }} ({{ totalElements }} orders total)
    </p>

    <div class="flex space-x-2">
      <!-- Previous Button -->
      <button 
        (click)="goToPage(currentPage - 1)"
        [disabled]="currentPage === 0"
        [ngClass]="{
          'bg-gray-200 text-gray-500 cursor-not-allowed': currentPage === 0,
          'bg-emerald-500 hover:bg-emerald-600 text-white': currentPage > 0
        }"
        class="px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200">
        Previous
      </button>

      <!-- Page Numbers (Simple) -->
      <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
        <button 
          (click)="goToPage(i)"
          [ngClass]="{
            'bg-emerald-600 text-white font-bold': i === currentPage,
            'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300': i !== currentPage
          }"
          class="w-10 h-10 text-sm rounded-lg transition-colors duration-200">
          {{ i + 1 }}
        </button>
      </ng-container>

      <!-- Next Button -->
      <button 
        (click)="goToPage(currentPage + 1)"
        [disabled]="currentPage === totalPages - 1"
        [ngClass]="{
          'bg-gray-200 text-gray-500 cursor-not-allowed': currentPage === totalPages - 1,
          'bg-emerald-500 hover:bg-emerald-600 text-white': currentPage < totalPages - 1
        }"
        class="px-4 py-2 text-sm font-medium rounded-lg transition-colors duration-200">
        Next
      </button>
    </div>
  </div>
</div>

<!-- Order Details Modal (Unchanged) -->
<div *ngIf="isModalOpen && selectedOrder" 
     class="fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-75 transition-opacity duration-300 flex items-center justify-center">
  
  <div class="bg-white rounded-xl shadow-2xl max-w-lg w-full m-4 transform transition-transform duration-300 scale-100">
    
    <!-- Modal Header -->
    <div class="p-6 border-b flex justify-between items-center">
      <h3 class="text-2xl font-bold text-gray-800">Order #{{ selectedOrder.orderNumber }} Details</h3>
      <button (click)="closeDetailsModal()" class="text-gray-400 hover:text-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6 space-y-4">
      
      <!-- Restaurant and Date -->
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div>
          <p class="text-gray-500">Restaurant</p>
          <p class="font-semibold text-gray-900">{{ selectedOrder.restaurantName }}</p>
        </div>
        <div>
          <p class="text-gray-500">Order Date</p>
          <p class="font-semibold text-gray-900">{{ selectedOrder.orderDate | date: 'medium' }}</p>
        </div>
      </div>
      
      <!-- Delivery Details -->
      <div class="border-t pt-4">
        <p class="text-lg font-semibold mb-2">Delivery & Payment</p>
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div>
            <p class="text-gray-500">Address</p>
            <p class="font-semibold text-gray-900">{{ selectedOrder.deliveryAddress }}</p>
          </div>
          <div>
            <p class="text-gray-500">Payment</p>
            <p class="font-semibold text-gray-900">{{ selectedOrder.paymentMethod.replace('_', ' ') | titlecase }} ({{ selectedOrder.paymentStatus | titlecase }})</p>
          </div>
          <div>
            <p class="text-gray-500">Type</p>
            <p class="font-semibold text-gray-900">{{ selectedOrder.deliveryType | titlecase }}</p>
          </div>
          <div *ngIf="selectedOrder.estimatedDeliveryTime">
            <p class="text-gray-500">Est. Delivery</p>
            <p class="font-semibold text-gray-900">{{ selectedOrder.estimatedDeliveryTime | date: 'shortTime' }}</p>
          </div>
        </div>
        <div *ngIf="selectedOrder.specialInstructions" class="mt-3">
             <p class="text-gray-500">Instructions</p>
             <p class="text-sm italic text-gray-700 border-l-2 border-gray-200 pl-2">{{ selectedOrder.specialInstructions }}</p>
        </div>
      </div>
      
      <!-- Financial Summary -->
      <div class="border-t pt-4 space-y-1">
        <p class="text-lg font-semibold mb-2">Summary</p>
        <div class="flex justify-between text-sm text-gray-700"><span>Subtotal:</span><span>${{ selectedOrder.subtotal | number:'1.2-2' }}</span></div>
        <div class="flex justify-between text-sm text-gray-700"><span>Delivery Fee:</span><span>${{ selectedOrder.deliveryFee | number:'1.2-2' }}</span></div>
        <div class="flex justify-between text-sm text-gray-700"><span>Tax:</span><span>${{ selectedOrder.taxAmount | number:'1.2-2' }}</span></div>
        <div *ngIf="selectedOrder.discount > 0" class="flex justify-between text-sm text-red-500 font-medium"><span>Discount:</span><span>-${{ selectedOrder.discount | number:'1.2-2' }}</span></div>
        <div class="flex justify-between pt-2 border-t font-bold text-base text-gray-900"><span>Total Paid:</span><span>${{ selectedOrder.totalAmount | number:'1.2-2' }}</span></div>
      </div>

    </div>

    <!-- Modal Footer -->
    <div class="p-6 border-t flex justify-end">
      <button (click)="closeDetailsModal()" class="px-4 py-2 text-sm font-medium rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 transition-colors">
        Close
      </button>
    </div>
  </div>
</div>
