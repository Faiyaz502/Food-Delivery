<div class="bg-gray-100 min-h-screen font-sans antialiased">
  <!-- Top Header -->
  <div class="bg-indigo-900 text-white pt-6 pb-20 rounded-b-3xl shadow-2xl relative overflow-hidden">
    <div class="absolute inset-0 opacity-5">
      <div class="absolute top-10 -left-10 w-72 h-72 bg-indigo-500 rounded-full blur-3xl"></div>
      <div class="absolute bottom-10 -right-10 w-96 h-96 bg-purple-500 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-4xl mx-auto px-6 relative z-10">
      <!-- Main Title & Subtitle -->
      <div class="flex items-center justify-between mb-4">
        <div>
          <h1 class="text-3xl font-extrabold mb-0.5 tracking-tight">
            {{ order ? (currentPhase === "pickup" ? "Order Pickup" : "Order Delivery") : "Rider Dashboard" }}
          </h1>
          <p class="text-indigo-200 text-sm">
            {{
              order ?
                (currentPhase === "pickup" ? "Navigate to the restaurant" : "Finalize customer delivery")
                : "Ready for new orders"
            }}
          </p>
        </div>
          <!-- Wallet Balance (Medium size) -->
  <div class="flex items-center gap-2 bg-white/20 px-8 py-2 rounded-full backdrop-blur-sm border border-white/30">

    <i class="fas fa-wallet text-yellow-300 text-xl"></i>
     <span class="text-indigo-200 text-lg">Wallet :</span>
    <span class="text-white font-semibold text-xl">৳{{ rider?.wallet | number }}</span>

  </div>

        <!-- Action Buttons -->
        <div class="flex gap-3">
          <button
            (click)="triggerSOS()"
            title="Emergency SOS"
            class="relative h-10 w-10 rounded-full border-2 border-red-400 bg-red-500 flex items-center justify-center text-white hover:bg-red-600 transition-all group shadow-lg hover:shadow-red-500/30 active:scale-95">
            <i class="fas fa-exclamation-triangle text-lg"></i>
            <span
              class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-1 hidden group-hover:block px-2 py-1 bg-black text-white text-xs rounded whitespace-nowrap z-10">
              Emergency SOS
            </span>
          </button>

          <button
            (click)="toggleNotifications($event)"
            class="notification-bell relative h-10 w-10 rounded-full border-2 border-gray-300 hover:border-blue-600 hover:bg-blue-900 flex items-center justify-center transition-all active:scale-95">
            <i class="fas fa-bell text-gray-50"></i>
            <span
              *ngIf="unreadCount > 0"
              class="absolute -right-1 -top-1 flex h-5 w-5 items-center justify-center rounded-full bg-red-600 text-xs font-medium text-white">
              {{ unreadCount > 9 ? '9+' : unreadCount }}
            </span>
          </button>

          <button
            (click)="Logout()"
            class="notification-bell relative h-10 w-10 rounded-full border-2 border-gray-300 hover:border-red-600 hover:bg-red-900 flex items-center justify-center transition-all active:scale-95">
            <i class="fa-solid fa-right-from-bracket text-gray-50"></i>
          </button>
        </div>
      </div>

      <!-- Shift Banner -->
      <div *ngIf="shift" class="mb-6 mt-2">
        <div
          class="rounded-xl p-4 text-white text-center font-medium shadow-xl backdrop-blur-sm"
          [class.bg-green-600]="shift.status === 'ACTIVE'"
          [class.bg-blue-600]="shift.status === 'COMPLETED'"
          [class.bg-orange-500]="shift.status === 'AUTO_ENDED'">
          <div class="flex flex-wrap justify-center items-center gap-3 text-sm">
            <span class="flex items-center gap-1.5">
              <i class="fas fa-user-clock"></i>
              <strong>{{ shift.riderName }}</strong> • Shift: {{ shift.date | date: 'EEE, dd MMM' }}
            </span>
            <span class="mx-2 text-gray-200 opacity-80">|</span>
            <span class="flex items-center gap-1">
              <i class="far fa-clock"></i>
              {{ shift.shiftStart | date: 'h:mm a' }}
              <span *ngIf="shift.shiftEnd">– {{ shift.shiftEnd | date: 'h:mm a' }}</span>
              <span *ngIf="!shift.shiftEnd && shift.status === 'ACTIVE'">– <span class="italic">ongoing</span></span>
            </span>
            <span class="mx-2 text-gray-200 opacity-80">|</span>
            <span class="flex items-center gap-1">
              <i class="fas fa-boxes"></i> {{ shift.completedDeliveries }} deliveries
            </span>
            <span class="mx-2 text-gray-200 opacity-80">|</span>
            <span class="flex items-center gap-1 font-bold">
              <i class="fas fa-coins text-yellow-200"></i> ৳{{ shift.finalPay }}
            </span>
            <span
              *ngIf="shift.status === 'ACTIVE'"
              class="px-3 py-1 bg-white/20 rounded-full text-xs uppercase tracking-wide font-semibold">
              {{ shift.status }}
            </span>
          </div>

          <div *ngIf="shift.status === 'ACTIVE' && !shift.shiftEnd" class="mt-2 text-sm">
            <i class="fas fa-stopwatch text-yellow-200"></i>
            <span class="ml-1">Shift duration: {{ formatDuration(shift.totalWorkHours) }}</span>
          </div>
        </div>
      </div>

      <!-- Shift End Button -->
      <button *ngIf="shift?.status === 'ACTIVE' && rider.availabilityStatus != 'BUSY'"
        (click)="shiftEnd()"
        class="px-5 py-2.5 my-2 bg-red-600 text-white rounded-lg font-semibold shadow-md hover:bg-red-700 hover:shadow-lg active:scale-95 transition-all duration-200 flex items-center gap-2 w-full sm:w-auto mx-auto sm:mx-0">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        End Shift
      </button>
    </div>
  </div>

  <!-- Notifications Panel -->
  <div
    *ngIf="showNotificationsPanel"
    class="notification-panel fixed top-16 right-4 z-50 w-96 max-h-96 overflow-y-auto bg-white rounded-lg shadow-xl border border-gray-200">
    <div class="p-4">
      <div class="flex justify-between items-center mb-4 sticky top-0 bg-white pb-2">
        <h2 class="text-xl font-bold text-gray-800">Notifications</h2>
        <button
          *ngIf="unreadCount > 0"
          (click)="markAllAsRead(); $event.stopPropagation()"
          class="px-3 py-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-xs font-medium transition">
          Mark all as read ({{ unreadCount }})
        </button>
      </div>

      <div *ngIf="loadingN" class="text-center py-6">
        <i class="fas fa-spinner fa-spin text-3xl text-indigo-600"></i>
      </div>

      <div *ngIf="!loadingN && notifications.length === 0" class="text-center py-6">
        <i class="fas fa-bell-slash text-4xl text-gray-300 mb-2"></i>
        <p class="text-gray-500 text-sm">No notifications yet</p>
      </div>

      <div class="space-y-3" *ngIf="!loadingN && notifications.length > 0">
        <div
          *ngFor="let notification of notifications"
          (click)="markAsRead(notification.id); $event.stopPropagation()"
          class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 cursor-pointer transition hover:shadow-md"
          [class.border-l-4]="!notification.isRead"
          [class.border-l-indigo-500]="!notification.isRead">
          <div class="flex gap-3">
            <div class="flex-shrink-0">
              <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center">
                <i class="fas fa-bell text-indigo-600 text-md"></i>
              </div>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex justify-between items-start">
                <h3 class="font-semibold text-gray-900 truncate text-sm">{{ notification.title }}</h3>
                <span class="text-xs text-gray-500 whitespace-nowrap ml-2">
                  {{ formatTimeAgo(notification.createdAt) }}
                </span>
              </div>
              <p class="text-gray-600 mt-1 text-xs">{{ notification.message }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Online/Offline Toggle -->
  <div *ngIf="rider.availabilityStatus != 'BUSY' && !shift?.shiftEnd" class="absolute w-full max-w-4xl left-1/2 -translate-x-1/2 -bottom-48 px-6 z-20">
    <div class="flex items-center gap-4 p-4 bg-white rounded-xl shadow-xl border border-gray-200">
      <div class="p-3 bg-green-500/10 rounded-lg">
        <i
          class="fas fa-power-off text-xl"
          [class.text-green-600]="isOnline"
          [class.text-gray-400]="!isOnline">
        </i>
      </div>
      <div class="flex-1">
        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">
          Status
        </p>
        <div class="flex gap-2">
          <button
            (click)="toggleStatus()"
            [disabled]="isToggling"
            [class.bg-green-600]="isOnline"
            [class.bg-gray-400]="!isOnline"
            [class.text-white]="isOnline"
            [class.text-gray-700]="!isOnline"
            class="px-4 py-1.5 rounded-lg font-bold text-sm shadow-md transition-all duration-200 flex items-center gap-1.5 active:scale-95">
            <span *ngIf="isToggling" class="fas fa-spinner fa-spin"></span>
            <span *ngIf="!isToggling">
              {{ isOnline ? 'Online' : 'Offline' }}
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-4xl mx-auto px-6 relative pt-8">
    <!-- Loading/Error -->
    <div *ngIf="loading" class="mt-8">
      <div class="bg-white rounded-2xl shadow-xl p-8 text-center border border-gray-200 animate-pulse">
        <i class="fas fa-spinner fa-spin text-4xl text-indigo-600 mb-4"></i>
        <p class="text-lg font-semibold text-gray-700">
          Loading...
        </p>
      </div>
    </div>

    <div *ngIf="error && !loading" class="mt-8">
      <div class="bg-red-100 border-l-4 border-red-500 p-4 rounded-r-lg shadow-md">
        <p class="text-red-800 font-medium">{{ error }}</p>
      </div>
    </div>

    <!-- ✅ ONLINE NAV / INCOMING ORDERS LIST -->
    <div *ngIf="!order && !loading && !error" class="pb-32">
      <div class="text-center py-16 bg-white rounded-2xl shadow-xl border border-gray-200">
        <div class="inline-block p-4 bg-indigo-100 rounded-full mb-6">
          <i class="fas fa-motorcycle text-indigo-600 text-5xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">
          {{ isOnline ? 'Ready for Orders' : 'You Are Offline' }}
        </h2>
        <p class="text-gray-500 mb-6 max-w-md mx-auto">
          <span *ngIf="isOnline">
            You're online and available. New orders will appear here automatically.
          </span>
          <span *ngIf="!isOnline">
            Go online to receive new orders.
          </span>
        </p>

        <!-- Incoming Orders List -->
        <div *ngIf="incomingOrders.length > 0" class="mt-8">
          <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center gap-2 justify-center">
            <i class="fas fa-bell text-indigo-500"></i>
            Pending Orders ({{ incomingOrders.length }})
          </h3>
          <div class="space-y-3 max-w-md mx-auto">
            <div
              *ngFor="let ord of incomingOrders"
              (click)="selectOrder(ord)"
              class="p-4 border border-gray-200 rounded-xl bg-gray-50 hover:bg-indigo-50 cursor-pointer transition shadow-sm">
              <div class="flex justify-between items-start">
                <div>
                  <span class="px-2 py-1 text-xs font-bold rounded-full text-white"
                        [class.bg-indigo-600]="ord.orderStatus === 'PREPARING'"
                        [class.bg-yellow-500]="ord.orderStatus === 'READY_FOR_PICKUP'"
                        [class.bg-green-600]="ord.orderStatus === 'OUT_FOR_DELIVERY'">
                    {{ ord.orderStatus | titlecase }}
                  </span>
                  <p class="font-semibold text-gray-800 mt-1">Order #{{ ord.orderNumber }}</p>
                  <p class="text-sm text-gray-600">{{ ord.restaurantName }}</p>
                </div>
                <div class="text-right">
                  <p class="font-bold text-lg text-gray-900">৳{{ ord.totalAmount }}</p>
                  <p class="text-xs text-gray-500">{{ formatTimeAgo(ord.createdAt) }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <button
          (click)="refreshOrders()"
          class="mt-6 px-6 py-2.5 mx-auto bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition shadow-md flex items-center gap-2">
          <i class="fas fa-sync-alt"></i> Refresh Orders
        </button>
      </div>
    </div>

    <!-- ✅ ORDER DETAIL VIEW -->
    <div *ngIf="order && !loading" class="pb-32">
      <div class="mb-6 bg-gradient-to-r from-gray-50 to-indigo-50 rounded-xl p-4 border border-gray-200 shadow-sm">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 text-sm">
          <div class="flex items-center gap-3">
            <span class="font-bold text-gray-700">Status:</span>
            <span class="px-3 py-1 rounded-full text-white font-medium text-sm"
                  [class.bg-indigo-600]="order.orderStatus === 'PREPARING'"
                  [class.bg-yellow-500]="order.orderStatus === 'READY_FOR_PICKUP'"
                  [class.bg-green-600]="order.orderStatus === 'OUT_FOR_DELIVERY'"
                  [class.bg-gray-500]="order.orderStatus === 'DELIVERED'">
              {{ order.orderStatus | titlecase }}
            </span>
          </div>
          <div class="text-xs text-gray-500 flex-shrink-0">
            <i class="far fa-clock"></i>
            <span class="ml-1">
              {{ order.createdAt | date: 'h:mm a' }} • {{ formatTimeAgo(order.createdAt) }}
            </span>
          </div>
        </div>

        <!-- Mini Timeline -->
        <div class="mt-4 flex justify-between items-center relative">
          <div class="absolute top-4 left-0 right-0 h-1 bg-gray-200 z-0"></div>
          <div class="relative z-10 flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-white shadow-md mb-2 bg-indigo-600">
              1
            </div>
            <span class="text-xs text-gray-600 whitespace-nowrap">Order Placed</span>
          </div>
          <div class="relative z-10 flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-white shadow-md mb-2"
                 [class.bg-indigo-600]="['READY_FOR_PICKUP','OUT_FOR_DELIVERY','DELIVERED'].includes(order.orderStatus)"
                 [class.bg-yellow-500]="order.orderStatus === 'READY_FOR_PICKUP'"
                 [class.bg-gray-300]="order.orderStatus === 'PREPARING'">
              <i *ngIf="order.orderStatus !== 'PREPARING'" class="fas fa-check text-xs"></i>
              <span *ngIf="order.orderStatus === 'PREPARING'">2</span>
            </div>
            <span class="text-xs text-gray-600 whitespace-nowrap">Ready</span>
          </div>
          <div class="relative z-10 flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-white shadow-md mb-2"
                 [class.bg-green-600]="order.orderStatus === 'OUT_FOR_DELIVERY'"
                 [class.bg-indigo-600]="order.orderStatus === 'DELIVERED'"
                 [class.bg-gray-300]="!['OUT_FOR_DELIVERY','DELIVERED'].includes(order.orderStatus)">
              <i *ngIf="['OUT_FOR_DELIVERY','DELIVERED'].includes(order.orderStatus)" class="fas fa-check text-xs"></i>
              <span *ngIf="!['OUT_FOR_DELIVERY','DELIVERED'].includes(order.orderStatus)">3</span>
            </div>
            <span class="text-xs text-gray-600 whitespace-nowrap">Out for Delivery</span>
          </div>
          <div class="relative z-10 flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-white shadow-md mb-2"
                 [class.bg-green-600]="order.orderStatus === 'DELIVERED'"
                 [class.bg-gray-300]="order.orderStatus !== 'DELIVERED'">
              <i *ngIf="order.orderStatus === 'DELIVERED'" class="fas fa-check text-xs"></i>
              <span *ngIf="order.orderStatus !== 'DELIVERED'">4</span>
            </div>
            <span class="text-xs text-gray-600 whitespace-nowrap">Delivered</span>
          </div>
        </div>
      </div>

      <div class="bg-yellow-100 border border-yellow-300 p-4 rounded-xl shadow-md mb-6 animate-pulse">
        <div class="flex items-center gap-4">
          <div class="p-2 bg-yellow-400/20 rounded-full">
            <i class="fas fa-motorcycle text-yellow-600 text-xl"></i>
          </div>
          <div>
            <p class="font-bold text-yellow-900 text-lg">New Order Assigned</p>
            <p class="text-sm text-yellow-800">
              Please proceed to **{{ currentPhase === "pickup" ? "Pickup" : "Delivery" }}** location immediately.
            </p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200 mb-6">
        <div class="bg-indigo-600 text-white p-6">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm opacity-80 mb-1 font-medium">Order ID</p>
              <p class="text-2xl font-extrabold tracking-wider">
                {{ order.orderNumber }}
              </p>
            </div>
            <div class="text-right">
              <p class="text-sm opacity-80 mb-1 font-medium">Total Payable</p>
              <p class="text-4xl font-extrabold tracking-tight">
                ৳{{ order.totalAmount | number : "1.0-0" }}
              </p>
            </div>
          </div>
        </div>

        <div class="divide-y divide-gray-100">
          <div class="p-6 bg-white hover:bg-green-50/70 transition duration-300">
            <div class="flex items-start gap-4">
              <div class="p-3 bg-green-500 rounded-full shadow-lg shrink-0">
                <i class="fas fa-store text-white text-xl"></i>
              </div>
              <div class="flex-1">
                <p class="text-xs text-green-600 uppercase font-extrabold mb-1 tracking-wide flex items-center gap-2">
                  <i class="fas fa-truck-loading text-xs"></i>
                  Pickup Location
                </p>
                <h3 class="text-xl font-bold text-gray-900 mb-2">
                  {{ order.restaurantName }}
                </h3>
                <button
                  (click)="callRestaurant()"
                  class="inline-flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-semibold text-sm transition shadow-md shadow-green-500/30 active:scale-95">
                  <i class="fas fa-phone"></i>
                  <span>Call Restaurant</span>
                </button>
              </div>
            </div>
          </div>

          <div class="p-6 bg-white hover:bg-blue-50/70 transition duration-300">
            <div class="flex items-start gap-4">
              <div class="p-3 bg-blue-600 rounded-full shadow-lg shrink-0">
                <i class="fas fa-user text-white text-xl"></i>
              </div>
              <div class="flex-1">
                <p class="text-xs text-blue-600 uppercase font-extrabold mb-1 tracking-wide flex items-center gap-2">
                  <i class="fas fa-map-pin text-xs"></i>
                  Delivery Destination
                </p>
                <h3 class="text-xl font-bold text-gray-900 mb-2">
                  {{ order.customerName }}
                </h3>
                <p class="text-sm text-gray-600 flex items-start gap-2 mb-4">
                  <i class="fas fa-map-marker-alt text-blue-500 mt-1"></i>
                  <span>{{ order.deliveryAddress }}</span>
                </p>
                <button
                  (click)="callCustomer()"
                  class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold text-sm transition shadow-md shadow-blue-500/30 active:scale-95">
                  <i class="fas fa-phone"></i>
                  <span>Call Customer</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="p-6 border-t border-gray-100 bg-gray-50">
          <div class="grid grid-cols-2 gap-4">
            <div class="flex items-center gap-4 p-4 bg-white rounded-xl shadow-inner border border-purple-100">
              <div class="p-3 bg-purple-100 rounded-lg">
                <i class="fas fa-route text-purple-600 text-2xl"></i>
              </div>
              <div>
                <p class="text-xs text-gray-500 font-semibold uppercase">Distance</p>
                <p class="font-bold text-gray-900 text-2xl">3.2 km</p>
              </div>
            </div>
            <div class="flex items-center gap-4 p-4 bg-white rounded-xl shadow-inner border border-orange-100">
              <div class="p-3 bg-orange-100 rounded-lg">
                <i class="fas fa-clock text-orange-600 text-2xl"></i>
              </div>
              <div>
                <p class="text-xs text-gray-500 font-semibold uppercase">Est. Time</p>
                <p class="font-bold text-gray-900 text-2xl">
                  {{ getEstimatedTime() | date: 'h:mm a' }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="p-6 border-t border-gray-100">
          <h4 class="font-extrabold text-gray-900 mb-4 flex items-center gap-3 text-xl">
            <i class="fas fa-shopping-bag text-indigo-600"></i>
            Order Details
            <span class="text-sm font-medium text-gray-500">
              ({{ getTotalItems() | date }} items)
            </span>
          </h4>
          <div class="space-y-3">
            <div
              *ngFor="let item of order.orderItems"
              class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border border-gray-100">
              <div class="flex items-center gap-3">
                <span class="bg-indigo-500 text-white font-bold px-3 py-1.5 rounded-full text-sm shadow-md shadow-indigo-500/20">
                  {{ item.quantity }}x
                </span>
                <span class="text-gray-800 font-semibold">{{ item.menuItemName }}</span>
              </div>
              <span class="font-bold text-gray-900 text-lg">
                ৳{{ item.totalPrice | number : "1.0-0" }}
              </span>
            </div>
          </div>
          <div class="mt-6 pt-4 border-t border-gray-200 flex justify-between items-center px-3">
            <span class="font-extrabold text-gray-900 text-xl">Total Payable</span>
            <span class="font-extrabold text-indigo-600 text-3xl">
              ৳{{ order.totalAmount | number : "1.0-0" }}
            </span>
          </div>
        </div>

        <div *ngIf="order.specialInstructions" class="p-6 bg-yellow-50 border-t border-yellow-200">
          <h4 class="font-bold text-gray-900 mb-2 flex items-center gap-3 text-lg">
            <i class="fas fa-sticky-note text-yellow-600"></i>
            Special Instructions
          </h4>
          <p class="text-sm text-gray-700 p-3 bg-white rounded-lg border border-yellow-200">
            {{ order.specialInstructions }}
          </p>
        </div>

        <div *ngIf="order.orderStatus == 'OUT_FOR_DELIVERY'" class="bg-white rounded-xl p-4 shadow-sm border border-gray-200">
          <label class="text-sm font-semibold mb-3 block text-gray-700">
            Enter Delivery OTP
          </label>
          <input
            type="text"
            placeholder="Enter 4-digit OTP"
            maxlength="4"
            [(ngModel)]="deliveryOtp"
            class="w-full text-center text-2xl font-mono font-bold py-4 border-2 border-gray-300 rounded-xl focus:border-indigo-500 focus:outline-none transition placeholder:text-gray-400" />
        </div>

        <div class="p-6 border-t border-gray-100">
          <h4 class="font-bold text-gray-900 mb-4 flex items-center gap-3 text-xl">
            <i class="fas fa-map text-indigo-600"></i>
            Route Map
          </h4>
          <div class="relative bg-gray-200 rounded-xl overflow-hidden h-64 shadow-inner border border-gray-300">
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center">
                <i class="fas fa-map-marked-alt text-6xl text-indigo-400 opacity-70 mb-3"></i>
                <p class="text-lg font-bold text-gray-800">Navigation Ready</p>
                <p class="text-sm text-gray-600 mt-1">
                  {{
                    currentPhase === "pickup"
                      ? "3.2 km to restaurant"
                      : "2.1 km to customer"
                  }}
                </p>
              </div>
            </div>
            <button
              (click)="openNavigation()"
              class="absolute top-4 right-4 bg-white px-5 py-2 rounded-full shadow-xl text-sm font-bold text-indigo-600 hover:bg-indigo-50 transition flex items-center gap-2 border border-indigo-100 active:scale-95">
              <i class="fas fa-directions"></i>
              <span>Open Map App</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase-Specific Action Bars -->
  <div *ngIf="order && currentPhase === 'pickup'" class="fixed bottom-0 left-0 right-0 bg-white shadow-3xl border-t border-gray-200 p-6 z-10">
    <div class="max-w-4xl mx-auto space-y-4">
      <button
        (click)="onArrivedAtRestaurant()"
        *ngIf="order.orderStatus == 'PREPARING'"
        [disabled]="loading"
        class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-extrabold py-4 rounded-xl transition shadow-lg shadow-yellow-500/40 flex items-center justify-center gap-3 text-lg disabled:opacity-60 disabled:cursor-not-allowed active:scale-95">
        <i class="fas fa-map-marker-alt text-2xl"></i>
        <span>Arrived at Restaurant</span>
      </button>
      <button
        (click)="onPickupComplete()"
        *ngIf="order.orderStatus == 'READY_FOR_PICKUP'"
        [disabled]="loading"
        class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-extrabold py-4 rounded-xl transition shadow-lg shadow-indigo-600/40 flex items-center justify-center gap-3 text-lg disabled:opacity-60 disabled:cursor-not-allowed active:scale-95">
        <i [class.fa-spinner]="loading" [class.fa-spin]="loading" [class.fa-check-circle]="!loading" class="fas text-2xl"></i>
        <span>{{ loading ? "Processing..." : "Mark Order as Picked Up" }}</span>
      </button>
    </div>
  </div>

  <div *ngIf="order && currentPhase === 'delivery'" class="fixed bottom-0 left-0 right-0 bg-white shadow-3xl border-t border-gray-200 p-6 z-10">
    <div class="max-w-4xl mx-auto space-y-4">
      <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4 shadow-sm">
        <p class="text-sm font-semibold text-blue-800 flex items-center gap-2">
          <i class="fas fa-box-open"></i>
          Order is with you. Head to the customer now!
        </p>
      </div>
      <button
        (click)="onDeliveryComplete()"
        [disabled]="loading"
        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-extrabold py-4 rounded-xl transition shadow-lg shadow-blue-600/40 flex items-center justify-center gap-3 text-lg disabled:opacity-60 disabled:cursor-not-allowed active:scale-95">
        <i [class.fa-spinner]="loading" [class.fa-spin]="loading" [class.fa-check-circle]="!loading" class="fas text-2xl"></i>
        <span>{{ loading ? "Processing..." : "Confirm Delivery Complete" }}</span>
      </button>
    </div>
  </div>

  <!-- Rider Support Badge -->
  <div class="fixed bottom-24 left-4 z-40" *ngIf="shift">
    <div class="bg-white rounded-xl shadow-lg p-3 border border-gray-200 max-w-xs text-sm">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center font-bold text-indigo-800">
          {{ shift.riderName.charAt(0).toUpperCase() || '?' }}
        </div>
        <div>
          <p class="font-semibold text-gray-800">{{ shift.riderName }}</p>
          <p class="text-xs text-gray-500">ID: #{{ shift.riderId }}</p>
        </div>
      </div>
      <button
        (click)="openSupportChat()"
        class="w-full mt-2 flex items-center justify-center gap-2 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition active:scale-95">
        <i class="fas fa-headset"></i> Support
      </button>
    </div>
  </div>

  <!-- Toast -->
  <div *ngIf="toastMessage" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg animate-fadeIn">
    {{ toastMessage }}
  </div>
</div>
